# weewx-s3

This repository is a fork of https://github.com/jonotaegi/weewx-s3 (which is also a fork),
a weeWX extension to sync web files to an Cloudflare R2 bucket.

Rather than serving the web pages generated by weeWX directly from a 
webserver running on the same system as weeWX, those pages can be 
uploaded to an Cloudflare R2 bucket. The bucket is configured to be a 
static website.

This has been tested against weeWX 4.10.x.

NOTE: Additional configuration for the links within certain themes, Belchertown is a known example, because Cloudflare R2 does not support setting index's. If you have issues with this you can use Cloudflare redirect rules to redirect to the correct index page or change the link locations within the theme/skin html. 

## Setup

Before installing this extensions, get an R2 bucket at https://dash.cloudflare.com/sign-up/r2. Sign into the management console, create an
account if necessary, then create an R2 bucket.


Install `s3cmd` from your distros repo eg, apt install s3cmd


## Installation instructions

1. Download the extension

  ```
  wget -O weewx-s3.zip https://github.com/ryan910/weewx-R2/archive/master.zip
  ```

2. Install the extension

  ```
  sudo wee_extension --install weewx-s3.zip
  ```

3. Modify the S3 stanza in weewx.conf and set your S3 access code,
secret token, and bucket name. You will get those when you set up
the bucket you want to use.

4. Restart weeWX

  ```
  sudo systemctl restart weewx
  ```

## Manual installation instructions:

1. Clone this repo

  ```
  git clone git@github.com:ryan910/weewx-R2 ~/weewx-s3
  ```

2. Copy files to the weeWX user directory

  ```
  cp -rp ~/weewx-s3/skins/S3 /home/weewx/skins
  cp -rp ~/weewx-s3/bin/user/s3.py /home/weewx/bin/user
  ```

3. Add the following to weewx.conf

  ```
  [StdReport]
      ...
      [[S3]]
          skin = S3
          access_key = 'REPLACE_WITH_YOUR_S3_ACCESS_KEY'
          secret_token ='REPLACE_WITH_YOUR_SECRET_TOKEN'
          bucket = 'REPLACE_WITH_THE_NAME_OF_YOUR_S3_BUCKET'
          account_url = 'replace with <ACCOUNT_ID>.r2.cloudflarestorage.com'
  ```

4. Restart weeWX

  ```
  sudo systemctl restart weewx
  ```
